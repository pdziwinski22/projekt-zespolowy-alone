<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>AI Studio (GPT-4o + DALL-E)</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    
    <style>
        /* Styl dla nak≈Çadki ≈Çadowania (Loader) */
        .loading-overlay {
            display: none; /* Domy≈õlnie ukryty */
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #fff;
            backdrop-filter: blur(5px);
        }
        .spinner-border {
            width: 4rem; height: 4rem;
        }
        .ai-pulse {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; text-shadow: 0 0 20px #3b82f6; }
            100% { opacity: 0.6; }
        }
    </style>
</head>
<body class="bg-light">

<div id="loader" class="loading-overlay">
    <div class="spinner-border text-primary mb-4" role="status"></div>
    <h3 id="loader-text" class="ai-pulse">Przetwarzanie AI...</h3>
    <p class="text-muted mt-2">To mo≈ºe potrwaƒá kilka sekund. Czekaj...</p>
</div>

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-white fw-bold">AI Studio <span class="badge bg-primary fs-6 align-middle ms-2">v2.0</span></h1>
        <a href="/logs" class="btn btn-outline-light rounded-pill px-4"><i class="bi bi-clock-history me-2"></i>Historia</a>
    </div>

    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if not active_tab or active_tab == 'process' %}active{% endif %}" 
                    id="pills-edit-tab" data-bs-toggle="pill" data-bs-target="#pills-edit" 
                    type="button" role="tab">üõ†Ô∏è Edycja Zdjƒôƒá</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if active_tab == 'generate' %}active{% endif %}" 
                    id="pills-gen-tab" data-bs-toggle="pill" data-bs-target="#pills-gen" 
                    type="button" role="tab">üé® Generator DALL-E</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if active_tab == 'medical' %}active{% endif %}" 
                    id="pills-med-tab" data-bs-toggle="pill" data-bs-target="#pills-med" 
                    type="button" role="tab">üè• Analiza Medyczna</button>
        </li>
    </ul>

    <div class="tab-content card card-body p-4" id="pills-tabContent">
        
        <div class="tab-pane fade {% if not active_tab or active_tab == 'process' %}show active{% endif %}" id="pills-edit" role="tabpanel">
            <form action="/process" method="post" enctype="multipart/form-data" class="row g-3" onsubmit="showLoader('Nak≈Çadanie filtr√≥w i analiza obrazu...')">
                <div class="col-md-6">
                    <label for="file" class="form-label">Wgraj zdjƒôcie</label>
                    <input type="file" name="file" class="form-control" accept="image/*" required>
                </div>
                <div class="col-md-4">
                    <label for="effect" class="form-label">Wybierz Efekt</label>
                    <select name="effect" class="form-select">
                        <option value="grayscale">Czarno-bia≈Çe</option>
                        <option value="sepia">Sepia</option>
                        <option value="brighten">Rozja≈õnij (+20%)</option>
                        <option value="contrast">Kontrast (+30%)</option>
                        <option value="compress">Kompresja JPEG</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100 rounded-pill">Przetw√≥rz</button>
                </div>
            </form>

            {% if processed_image and active_tab == 'process' %}
            <hr class="my-4 border-secondary">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <h5 class="text-white-50">Orygina≈Ç</h5>
                    <img src="{{ original_image }}" class="img-fluid rounded border border-secondary preview-image">
                </div>
                <div class="col-md-6 mb-3">
                    <h5 class="text-primary">Wynik ({{ effect }})</h5>
                    <img src="{{ processed_image }}" class="img-fluid rounded border border-primary preview-image mb-3">
                    <div class="alert alert-dark border-secondary">
                        <i class="bi bi-stars text-warning me-2"></i> <strong>Opis AI:</strong><br>
                        {{ ai_desc }}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="tab-pane fade {% if active_tab == 'generate' %}show active{% endif %}" id="pills-gen" role="tabpanel">
            <form action="/generate" method="post" class="row g-3 align-items-end" onsubmit="showLoader('Generowanie obrazu w DALL-E 3...')">
                <div class="col-md-9">
                    <label for="prompt" class="form-label">Co chcesz wygenerowaƒá?</label>
                    <input type="text" name="prompt" class="form-control" placeholder="np. Futurystyczny samoch√≥d w Warszawie, cyberpunk style..." required value="{{ prompt }}">
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-success w-100 rounded-pill"><i class="bi bi-magic me-2"></i>Generuj</button>
                </div>
            </form>

            {% if generated_url and active_tab == 'generate' %}
            <hr class="my-4 border-secondary">
            <div class="text-center">
                <h4 class="text-white mb-3">Tw√≥j obraz:</h4>
                <img src="{{ generated_url }}" class="img-fluid rounded shadow-lg mb-3 border border-success" style="max-height: 500px;">
                <br>
                <a href="{{ generated_url }}" target="_blank" class="btn btn-outline-info rounded-pill px-4">
                    <i class="bi bi-download me-2"></i>Pobierz orygina≈Ç
                </a>
            </div>
            {% endif %}
        </div>

        <div class="tab-pane fade {% if active_tab == 'medical' %}show active{% endif %}" id="pills-med" role="tabpanel">
            <div class="alert alert-danger d-flex align-items-center" role="alert">
                <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
                <div>
                    <strong>Modu≈Ç eksperymentalny!</strong><br>
                    Ten model nie zastƒôpuje lekarza. Nie podejmuj decyzji zdrowotnych na podstawie tej analizy.
                </div>
            </div>
            
            <form action="/analyze-medical" method="post" enctype="multipart/form-data" class="mb-4" onsubmit="showLoader('Dr. GPT analizuje Twoje zdjƒôcie...')">
                <div class="input-group">
                    <input type="file" name="file" class="form-control" accept="image/*" required>
                    <button class="btn btn-danger px-4" type="submit">
                        <i class="bi bi-activity me-2"></i>Diagnozuj
                    </button>
                </div>
            </form>

            {% if medical_image and active_tab == 'medical' %}
            <div class="row mt-4">
                <div class="col-md-5">
                    <h5 class="text-white-50">Przes≈Çany obraz</h5>
                    <img src="{{ medical_image }}" class="img-fluid rounded border border-danger">
                </div>
                <div class="col-md-7">
                    <div class="card bg-dark text-white border-danger h-100">
                        <div class="card-header bg-danger text-white fw-bold">
                            <i class="bi bi-clipboard2-pulse me-2"></i>Raport Medyczny AI
                        </div>
                        <div class="card-body">
                            <p style="white-space: pre-wrap; line-height: 1.6;">{{ medical_desc }}</p>
                        </div>
                        <div class="card-footer text-muted small border-danger">
                            Model: GPT-4o Vision | Tryb: Medical Analysis
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function showLoader(text) {
        document.getElementById('loader').style.display = 'flex';
        if(text) document.getElementById('loader-text').innerText = text;
    }
</script>
</body>
</html>